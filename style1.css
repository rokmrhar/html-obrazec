let currentStep = 0;
const tabs = document.querySelectorAll(".tab");
const circles = document.querySelectorAll(".circle");
const progress = document.getElementById("progress");

function showStep(step) {
    tabs.forEach((tab, index) => {
        tab.classList.toggle("active", index === step);
    });
    circles.forEach((circle, index) => {
        circle.classList.toggle("active", index <= step);
    });

    progress.style.width = `${(step / (circles.length - 1)) * 100}%`;
}

function nextStep() {
    if (currentStep < tabs.length - 1) {
        if (validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);
        }
    }
}

function previousStep() {
    if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
    }
}

document.addEventListener("DOMContentLoaded", () => {
    showStep(currentStep);
});

document.getElementById("multiStepForm").onsubmit = function(event) {
    if (!validateForm()) {
        event.preventDefault(); 
    } else {
        myFunction();
    }
};

function validateForm() {
    let isValid = true;
    const requiredFields = document.querySelectorAll("#multiStepForm [required]");
    
    for (let field of requiredFields) {
        if (!field.value.trim()) {
            isValid = false;
            field.classList.add("invalid");
            Swal.fire({
                title: "Napaka!",
                text: `Prosimo, izpolnite polje: ${getLabel(field)}`,
                icon: "error",
                confirmButtonText: "V redu"
            });
            return false;
        } else {
            field.classList.remove("invalid");
        }
    }

    return isValid;
}

function validateStep(step) {
    let isValid = true;
    const stepFields = tabs[step].querySelectorAll("[required]");
    
    for (let field of stepFields) {
        if (!field.value.trim()) {
            isValid = false;
            field.classList.add("invalid");
            Swal.fire({
                title: "Napaka!",
                text: `Prosimo, izpolnite vsa polja označena z *`,
                icon: "error",
                confirmButtonText: "V redu"
            });
            return false;
        } else {
            field.classList.remove("invalid");
        }
    }

    return isValid;
}

function getLabel(field) {
    const label = field.previousElementSibling;
    return label ? label.textContent.trim() : "neznano polje";
}

function myFunction() {
    Swal.fire({
        title: "Oddali ste prijavo!",
        text: "Najlepša hvala!",
        icon: "success",
        confirmButtonText: "Zapri obvestilo"
    });
}
